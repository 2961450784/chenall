title: "【分享】免费安全纯软件连锁VPN解决方案 （简版）"
id: 107
date: 2009-10-31 23:31:57
tags: 
- openvpn
- 原创
categories: 
- 系统相关/网络
---

1、用途: 连锁超市，卖场，酒店，等。总部与各个分店之间的连接，实现实时连锁经营。

2、最终效果：各个分店与总部之前通过VPN连接，形成一个大的局域网络，所有电脑之间均可互连互访。 

<!--more-->

需求与方法： 

1.  总部与各分店均需要一台可以上网的电脑作为VPN服务器充当路由器角色（用于本地网和VPN网的连接转换）
2.  为了保证安全，可以关闭所有端口，只开放VPN端口。
3.  VPN服务器，安装WINDOWS SERVER版操作系统
4.  在VPN服务器中安装VPN软件，并配置好路由。 建议使用Softether配置比较简单，但如果使用SERVER 2008系统则还是用OpenVPN。
5.  本地网络其它电脑的IP设置的网关IP指向本地VPN服务器的IP。 

实现例子：(希望对您有用，有兴趣可以一起讨论下。）

1.  共有2个分店，1个总部。
2.  为了速度的要求，总部使用光纤接入，分店使用普通ADSL接入。
3.  总部的本地网络的IP网段为:192.100.0.0/24  
    分店1的IP网段为：192.100.1.0/24  
    分店2的IP网段为 : 192.100.2.0/24  
    说明：192.100.0.0/24  IP地址为192.100.0 开头，子网掩码为255.255.255.0
4.  在总部和分店各找出一台可以上网的计算机充当路由器角色。为了方便这些电脑的IP最后一位相同。
    总部的路由器IP地址为: 192.100.0.254/24  
    分店1的路由器IP地址: 192.100.1.254/24  
    分店2的路由器IP地址: 192.100.2.254/24  
5.  在4的电脑上安装VPN软件。(本文介绍的是使用虚拟网卡类VPN）
    安装好虚拟网卡软件并配置好IP地址：  
    总部的IP配置: 192.101.1.254 子网掩码：255.255.255.0 网关：不用设置  
    分店1的IP配置: 192.101.1.1 子网掩码：255.255.255.0 网关：不用设置  
    分店2的IP配置: 192.101.1.2 子网掩码：255.255.255.0 网关：不用设置  
6.  在4的电脑上配置好路由，为了方便使用RIP路由协议。如果分店比较多可以使用OSPF大型路由协议  
    6.1 首先，启用路由和远程访问（从系统的管理工具-路由和远程访问进入设置）。  
    6.2 添加RIP协议（展开 IP 路由选择,在常规上点右键新增路由协议添加）  
    6.3 为RIP协议指定使用的网卡（右键点击RIP协议，接增接口，选择虚拟网卡）  
    6.4 可选设置，设置RIP通讯密码，也就是激活身份验证，只有密码相同才可以互访。  
7.  对其它的电脑进行IP配置。最终IP配置如下。 
    总部所有电脑的IP设置：IP:*192.100.0.XXX* 子网掩码：*255.255.255.0* 网关:*192.100.0.254*  
    分店1所有电脑的IP设置：IP:*192.100.1.XXX* 子网掩码：*255.255.255.0* 网关:*192.100.1.254*  
    分店2所有电脑的IP设置：IP:*192.100.2.XXX* 子网掩码：*255.255.255.0* 网关:*192.100.2.254*  
8.  以上设置好了以后就可以直接互连互访了。
    像总部*192.100.0.5* 的电脑可以直接访问*192.100.1.6*的电脑，等.. 

附简易连接图示（画得不好，别拍砖,,,,,)：

![]([CDN_URL]:/post/soft_vpn.png)

如果实在不懂得RIP路由配置，可以使用另一个方法，比较简单。也不需要设置网关。

1.  把VPN服务器上的本地连接网卡和虚拟网卡进行桥接，桥接后只剩下一个IP。直接使用本地连接的IP地址就行了。
2.  所有电脑的子网掩码改为255.255.0.0
3.  这样子也可以实现所有电脑直接互联互访。
